{"version":3,"file":"toy-vue.js","sources":["../src/compiler/parse.js","../src/compiler/index.js","../src/vdom/index.js","../src/lifecycle.js","../src/utils/index.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); \r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`);  \r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;  \r\n\r\nconst startTagClose = /^\\s*(\\/?)>/;  \r\n\r\n\r\n/**\r\n * 把模板转换为AST树\r\n * @param {*} html \r\n * @returns \r\n */\r\nexport function parseHTML(html) { \r\n\r\n    const ELEMENT_TYPE = 1;\r\n    const TEXT_TYPE = 3;\r\n    const stack = []; \r\n    let currentParent; \r\n    let root;\r\n\r\n    // 生成AST节点\r\n    function createASTElement(tag, attrs) {\r\n        return {\r\n            tag,\r\n            type: ELEMENT_TYPE,\r\n            children: [],\r\n            attrs,\r\n            parent: null\r\n        }\r\n    }\r\n\r\n    // 开始标签\r\n    function start(tag, attrs) {\r\n        let node =  createASTElement(tag,attrs); \r\n        if(!root){ \r\n            root = node; \r\n        } \r\n        if(currentParent){\r\n            node.parent = currentParent; \r\n            currentParent.children.push(node); \r\n        }\r\n        stack.push(node);\r\n        currentParent = node; \r\n    }\r\n    // 文本\r\n    function chars(text) { \r\n        text = text.replace(/\\s/g,' '); \r\n        text && currentParent.children.push({\r\n            type:TEXT_TYPE,\r\n            text,\r\n            parent:currentParent\r\n        });\r\n    }\r\n    // 结束标签\r\n    function end(tag) {\r\n       let node =  stack.pop();  \r\n       currentParent = stack[stack.length - 1];\r\n    }\r\n    // 截取html\r\n    function advance(n) {\r\n        html = html.substring(n);\r\n    }\r\n    // 解析开始标签\r\n    function parseStartTag() {\r\n        const start = html.match(startTagOpen);\r\n        if (start) {\r\n            const match = {\r\n                tagName: start[1], \r\n                attrs: []\r\n            }\r\n            advance(start[0].length);\r\n            \r\n            let attr, end\r\n            while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n                advance(attr[0].length);\r\n                match.attrs.push({ name: attr[1], value: attr[3] || attr[4] || attr[5] || true })\r\n            }\r\n            if (end) {\r\n                advance(end[0].length)\r\n            }\r\n            return match;\r\n        }\r\n        return false; \r\n    }\r\n    while (html) {\r\n        \r\n        let textEnd = html.indexOf('<');  \r\n        if (textEnd == 0) {\r\n            const startTagMatch = parseStartTag(); \r\n            if (startTagMatch) { \r\n                start(startTagMatch.tagName, startTagMatch.attrs)\r\n                continue\r\n            }\r\n            let endTagMatch = html.match(endTag);\r\n            if (endTagMatch) {\r\n                advance(endTagMatch[0].length);\r\n                end(endTagMatch[1])\r\n                continue;\r\n            }\r\n        }\r\n        if (textEnd > 0) {\r\n            let text = html.substring(0, textEnd); \r\n            if (text) {\r\n                chars(text)\r\n                advance(text.length); \r\n            }\r\n        }\r\n    }\r\n    \r\n\r\n    return root;\r\n}","import { parseHTML } from \"./parse\";\r\n\r\n\r\n/**\r\n * \r\n * _c 创建元素\r\n * _v 创建文本 \r\n * _s 拼接文本\r\n * \r\n */\r\n\r\n// 生成属性字符串\r\nfunction genProps(attrs) {\r\n    let str = ''\r\n    for (let i = 0; i < attrs.length; i++) {\r\n        let attr = attrs[i];\r\n        if (attr.name === 'style') {\r\n           \r\n            let obj = {};\r\n            attr.value.split(';').forEach(item => { \r\n                let [key, value] = item.split(':');\r\n                obj[key] = value;\r\n            });\r\n            attr.value = obj\r\n        }\r\n        str += `${attr.name}:${JSON.stringify(attr.value)},` \r\n    }\r\n    return `{${str.slice(0, -1)}}`\r\n}\r\n\r\n// 小胡子正则\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; \r\n\r\n\r\n// 生成代码\r\nfunction gen(node) {\r\n    if (node.type === 1) {\r\n        return codegen(node);\r\n    } else {\r\n     \r\n        let text = node.text\r\n        if (!defaultTagRE.test(text)) {\r\n            return `_v(${JSON.stringify(text)})`\r\n        } else {\r\n           \r\n            let tokens = [];\r\n            let match;\r\n            defaultTagRE.lastIndex = 0;\r\n            let lastIndex = 0;\r\n         \r\n            while (match = defaultTagRE.exec(text)) {\r\n                let index = match.index; \r\n                if (index > lastIndex) {\r\n                    tokens.push(JSON.stringify(text.slice(lastIndex, index)))\r\n                }\r\n                tokens.push(`_s(${match[1].trim()})`)\r\n                lastIndex = index + match[0].length\r\n            }\r\n            if (lastIndex < text.length) {\r\n                tokens.push(JSON.stringify(text.slice(lastIndex)))\r\n            }\r\n            return `_v(${tokens.join('+')})`\r\n        }\r\n    }\r\n}\r\nfunction genChildren(children) {\r\n    return children.map(child => gen(child)).join(',')\r\n}\r\nfunction codegen(ast) {\r\n    let children = genChildren(ast.children);\r\n    let code = (`_c('${ast.tag}',${ast.attrs.length > 0 ? genProps(ast.attrs) : 'null'\r\n        }${ast.children.length ? `,${children}` : ''\r\n        })`)\r\n\r\n    return code;\r\n}\r\nexport function compileToFunction(template) {\r\n    let ast = parseHTML(template);\r\n    let code = codegen(ast);\r\n    code = `with(this){return ${code}}`;\r\n    let render = new Function(code); \r\n    return render;\r\n}\r\n","\r\n\r\n// 虚拟dom\r\nexport function createElementVNode(vm, tag, data, ...children) {\r\n    if (data == null) {\r\n        data = {}\r\n    }\r\n    let key = data.key;\r\n    if (key) {\r\n        delete data.key\r\n    }\r\n    return vnode(vm, tag, key, data, children);\r\n}\r\n\r\n// 文本节点\r\nexport function createTextVNode(vm, text) {\r\n    return vnode(vm, undefined, undefined, undefined, undefined, text);\r\n}\r\n\r\n\r\n// 虚拟节点\r\nfunction vnode(vm, tag, key, data, children, text) {\r\n    return {\r\n        vm,\r\n        tag,\r\n        key,\r\n        data,\r\n        children,\r\n        text\r\n        // ....\r\n    }\r\n}","import { createElementVNode, createTextVNode } from \"./vdom\"\r\n\r\n\r\n// 虚拟节点转成真实DOM\r\nfunction createElm(vnode){\r\n    let {tag,data,children,text} = vnode;\r\n    if(typeof tag === 'string'){ \r\n        vnode.el =  document.createElement(tag); \r\n        patchProps(vnode.el,data);\r\n        children.forEach(child => {\r\n            vnode.el.appendChild( createElm(child))\r\n        });\r\n    }else{\r\n        vnode.el = document.createTextNode(text)\r\n    }\r\n    return vnode.el\r\n}\r\n\r\n// 给元素设置属性\r\nfunction patchProps(el,props){\r\n    for(let key in props){\r\n        if(key === 'style'){ \r\n            for(let styleName in props.style){\r\n                el.style[styleName] = props.style[styleName];\r\n            }\r\n        }else{\r\n            el.setAttribute(key,props[key]);\r\n        }\r\n    }\r\n}\r\n\r\n// 新旧节点的对比\r\nfunction patch(oldVNode,vnode){\r\n    const isRealElement = oldVNode.nodeType;\r\n    if(isRealElement){\r\n        const elm = oldVNode; \r\n        const parentElm = elm.parentNode; \r\n        let newElm =  createElm(vnode);\r\n        parentElm.insertBefore(newElm,elm.nextSibling);\r\n        parentElm.removeChild(elm); \r\n\r\n        return newElm\r\n    }else{\r\n        \r\n    }\r\n}\r\n\r\n\r\n// 生命周期\r\nexport function initLifeCycle(Vue){\r\n    // 初始化生命周期钩子函数\r\n    Vue.prototype._update = function(vnode){ \r\n        const vm = this;\r\n        const el = vm.$el;\r\n        vm.$el = patch(el,vnode);\r\n    }\r\n\r\n  \r\n    Vue.prototype._c = function(){\r\n       return  createElementVNode(this,...arguments)\r\n    }\r\n \r\n    Vue.prototype._v = function(){\r\n        return createTextVNode(this,...arguments)\r\n    }\r\n    Vue.prototype._s = function(value){\r\n        if(typeof value !== 'object') return value\r\n        return JSON.stringify(value)\r\n    }\r\n    Vue.prototype._render = function(){\r\n       \r\n        \r\n        return this.$options.render.call(this); \r\n    }\r\n}\r\n\r\nexport function mountComponent(vm,el){ \r\n    vm.$el = el;\r\n    vm._update(vm._render()); \r\n}\r\n\r\n","export function isObject(val) {\r\n    return val!== null && typeof val === 'object';\r\n}\r\n\r\nexport function isFunction(val) {\r\n    return typeof val === 'function';\r\n}\r\n\r\nexport function isElement(ele) {\r\n    return ele.nodeType === 1;\r\n}\r\n\r\nexport function isString(ele) {\r\n    return typeof ele === 'string';\r\n}","\r\nlet oldArrayProto = Array.prototype;\r\n\r\nexport let newArrayProto = Object.create(oldArrayProto);\r\n\r\nlet methods = [\r\n    'push',\r\n    'pop',\r\n   'shift',\r\n    'unshift',\r\n   'reverse',\r\n   'sort',\r\n   'splice'\r\n];\r\n\r\nmethods.forEach(method => {\r\n    newArrayProto[method] = function (...args) {\r\n        const result = oldArrayProto[method].call(this,...args);\r\n        let inserted;\r\n        let ob = this.__ob__;\r\n        switch (method) {\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args;\r\n                break;\r\n            case'splice':\r\n                inserted = args.slice(2);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        if (inserted) ob.observeArray(inserted);\r\n        // ob.dep.notify();\r\n        return result;\r\n    }\r\n})","import { isObject } from \"../utils\";\r\nimport { newArrayProto } from \"./array\";\r\n\r\nclass Observer {\r\n    constructor(value) {\r\n        // 这也太巧妙了吧\r\n        // 给数据加了一个标识，如果数据上有__ob__则说明被观测过\r\n        Object.defineProperty(value, '__ob__', {\r\n            value: this,\r\n            enumerable: false,\r\n        })\r\n\r\n        if (Array.isArray(value)) {\r\n            value.__proto__ = newArrayProto;\r\n            this.observeArray(value);\r\n        } else {\r\n            this.walk(value);\r\n        } \r\n    }\r\n    walk(obj) {\r\n        const keys = Object.keys(obj);\r\n        for (let i = 0; i < keys.length; i++) {\r\n            defineReactive(obj, keys[i], obj[keys[i]]);\r\n        }\r\n    }\r\n    observeArray(arr) {\r\n        arr.forEach(item => observe(item))\r\n    }\r\n}\r\n\r\nexport function defineReactive(obj, key, value) {\r\n    // key 对应 的 value 可能是对象\r\n    observe(value);\r\n    Object.defineProperty(obj, key, {\r\n        get() {\r\n            return value;\r\n        },\r\n        set(newValue) {\r\n            if (newValue === value) return;\r\n            // 如果用户设置的是一个对象，应该将其进行劫持\r\n            observe(newValue);\r\n            value = newValue;\r\n        }\r\n    })\r\n}\r\n\r\n\r\nexport function observe(data) {\r\n    if (!isObject(data)) return;\r\n    if (data.__ob__ instanceof Observer) return data.__ob__;\r\n    return new Observer(data);\r\n}","import { observe } from \"./observe\";\r\nimport { isFunction } from \"./utils\";\r\n\r\nexport function initState(vm) {\r\n    const opts = vm.$options;\r\n    // if (opts.props) {\r\n    //     initProps(vm, opts.props);\r\n    // }\r\n    // if (opts.methods) {\r\n    //     initMethods(vm, opts.methods);\r\n    // }\r\n    if (opts.data) {\r\n        initData(vm);\r\n    }\r\n    // if (opts.computed) {\r\n    //     initComputed(vm, opts.computed);\r\n    // }\r\n}\r\n\r\n\r\nfunction proxy(vm, target, key) {\r\n    Object.defineProperty(vm, key, {\r\n        get() {\r\n            return vm[target][key];\r\n        },\r\n        set(newValue) {\r\n            vm[target][key] = newValue;\r\n        }\r\n    })\r\n}\r\n\r\nfunction initData(vm) {\r\n    let data = vm.$options.data;\r\n    data = vm._data = isFunction(data) ? data.call(vm) : data;\r\n\r\n    observe(data)\r\n\r\n    for (let key in data) {\r\n        proxy(vm, '_data', key);\r\n    }\r\n}","import { compileToFunction } from \"./compiler\";\r\nimport { mountComponent } from \"./lifecycle\";\r\nimport { initState } from \"./state\";\r\nimport { isElement, isString } from \"./utils\";\r\n\r\nexport function initMixin(Vue) {\r\n    Vue.prototype._init = function (options) {\r\n        const vm = this;\r\n        vm.$options = options;\r\n\r\n        // 状态初始化\r\n        initState(vm);\r\n        let el = options.el;\r\n\r\n        if (el) {\r\n            vm.$mount(el);\r\n        }\r\n    }\r\n\r\n    Vue.prototype.$mount = function (el) {\r\n        const vm = this;\r\n        el = document.querySelector(el);\r\n        let opts = vm.$options\r\n        if (!opts.render) { \r\n            let template; \r\n            if (!opts.template && el) { \r\n                template = el.outerHTML\r\n            } else {\r\n                if (el) {\r\n                    template = opts.template \r\n                }\r\n            }\r\n            if (template && el) {\r\n                const render = compileToFunction(template);\r\n                opts.render = render;\r\n            }\r\n        }\r\n        // 挂载\r\n        mountComponent(vm, el);\r\n        \r\n    }\r\n}","import { initMixin } from \"./init\";\r\nimport { initLifeCycle } from \"./lifecycle\";\r\n\r\nfunction TVue(options){ \r\n    this._init(options); \r\n}\r\n\r\n// 把_init挂到TVue原型链上\r\ninitMixin(TVue); \r\ninitLifeCycle(TVue);\r\n\r\nexport default TVue"],"names":["ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parseHTML","html","ELEMENT_TYPE","TEXT_TYPE","stack","currentParent","root","createASTElement","tag","attrs","type","children","parent","start","node","push","chars","text","replace","end","pop","length","advance","n","substring","parseStartTag","match","tagName","attr","name","value","textEnd","indexOf","startTagMatch","endTagMatch","genProps","str","i","obj","split","forEach","item","key","JSON","stringify","slice","defaultTagRE","gen","codegen","test","tokens","lastIndex","exec","index","trim","join","genChildren","map","child","ast","code","compileToFunction","template","render","Function","createElementVNode","vm","data","vnode","createTextVNode","undefined","createElm","el","document","createElement","patchProps","appendChild","createTextNode","props","styleName","style","setAttribute","patch","oldVNode","isRealElement","nodeType","elm","parentElm","parentNode","newElm","insertBefore","nextSibling","removeChild","initLifeCycle","Vue","prototype","_update","$el","_c","arguments","_v","_s","_render","$options","call","mountComponent","isObject","val","isFunction","oldArrayProto","Array","newArrayProto","Object","create","methods","method","args","result","inserted","ob","__ob__","observeArray","Observer","constructor","defineProperty","enumerable","isArray","__proto__","walk","keys","defineReactive","arr","observe","get","set","newValue","initState","opts","initData","proxy","target","_data","initMixin","_init","options","$mount","querySelector","outerHTML","TVue"],"mappings":"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"}