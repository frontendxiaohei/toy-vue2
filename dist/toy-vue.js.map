{"version":3,"file":"toy-vue.js","sources":["../src/utils/index.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["export function isObject(val) {\r\n    return val!== null && typeof val === 'object';\r\n}\r\n\r\nexport function isFunction(val) {\r\n    return typeof val === 'function';\r\n}","\r\nlet oldArrayProto = Array.prototype;\r\n\r\nexport let newArrayProto = Object.create(oldArrayProto);\r\n\r\nlet methods = [\r\n    'push',\r\n    'pop',\r\n   'shift',\r\n    'unshift',\r\n   'reverse',\r\n   'sort',\r\n   'splice'\r\n];\r\n\r\nmethods.forEach(method => {\r\n    newArrayProto[method] = function (...args) {\r\n        const result = oldArrayProto[method].call(this,...args);\r\n        let inserted;\r\n        let ob = this.__ob__;\r\n        switch (method) {\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args;\r\n                break;\r\n            case'splice':\r\n                inserted = args.slice(2);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        if (inserted) ob.observeArray(inserted);\r\n        // ob.dep.notify();\r\n        return result;\r\n    }\r\n})","import { isObject } from \"../utils\";\r\nimport { newArrayProto } from \"./array\";\r\n\r\nclass Observer {\r\n    constructor(value) {\r\n        // 这也太巧妙了吧\r\n        // 给数据加了一个标识，如果数据上有__ob__则说明被观测过\r\n        Object.defineProperty(value, '__ob__', {\r\n            value: this,\r\n            enumerable: false,\r\n        })\r\n\r\n        if (Array.isArray(value)) {\r\n            value.__proto__ = newArrayProto;\r\n            this.observeArray(value);\r\n        } else {\r\n            this.walk(value);\r\n        } \r\n    }\r\n    walk(obj) {\r\n        const keys = Object.keys(obj);\r\n        for (let i = 0; i < keys.length; i++) {\r\n            defineReactive(obj, keys[i], obj[keys[i]]);\r\n        }\r\n    }\r\n    observeArray(arr) {\r\n        arr.forEach(item => observe(item))\r\n    }\r\n}\r\n\r\nexport function defineReactive(obj, key, value) {\r\n    observe(value);\r\n    Object.defineProperty(obj, key, {\r\n        get() {\r\n            return value;\r\n        },\r\n        set(newValue) {\r\n            if (newValue === value) return;\r\n            observe(newValue);\r\n            value = newValue;\r\n        }\r\n    })\r\n}\r\n\r\n\r\nexport function observe(data) {\r\n    if (!isObject(data)) return;\r\n    if (data.__ob__ instanceof Observer) return data.__ob__;\r\n    return new Observer(data);\r\n}","import { observe } from \"./observe\";\r\nimport { isFunction } from \"./utils\";\r\n\r\nexport function initState(vm) {\r\n    const opts = vm.$options;\r\n    // if (opts.props) {\r\n    //     initProps(vm, opts.props);\r\n    // }\r\n    // if (opts.methods) {\r\n    //     initMethods(vm, opts.methods);\r\n    // }\r\n    if (opts.data) {\r\n        initData(vm);\r\n    }\r\n    // if (opts.computed) {\r\n    //     initComputed(vm, opts.computed);\r\n    // }\r\n}\r\n\r\n\r\nfunction proxy(vm, target, key) {\r\n    Object.defineProperty(vm, key, {\r\n        get() {\r\n            return vm[target][key];\r\n        },\r\n        set(newValue) {\r\n            vm[target][key] = newValue;\r\n        }\r\n    })\r\n}\r\n\r\nfunction initData(vm) {\r\n    let data = vm.$options.data;\r\n    data = vm._data = isFunction(data) ? data.call(vm) : data;\r\n\r\n    observe(data)\r\n\r\n    for (let key in data) {\r\n        proxy(vm, '_data', key);\r\n    }\r\n}","import { initState } from \"./state\";\r\n\r\nexport function initMixin(Vue) {\r\n    Vue.prototype._init = function (options) {\r\n        const vm = this;\r\n        vm.$options = options;\r\n        initState(vm);\r\n    }\r\n}","import { initMixin } from \"./init\";\r\n\r\nfunction TVue(options){ \r\n    this._init(options); \r\n}\r\n\r\n// 把_init挂到TVue原型链上\r\ninitMixin(TVue); \r\n\r\nexport default TVue"],"names":["isObject","val","isFunction","oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","inserted","ob","__ob__","slice","observeArray","Observer","constructor","value","defineProperty","enumerable","isArray","__proto__","walk","obj","keys","i","length","defineReactive","arr","item","observe","key","get","set","newValue","data","initState","vm","opts","$options","initData","proxy","target","_data","initMixin","Vue","_init","options","TVue"],"mappings":"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"}